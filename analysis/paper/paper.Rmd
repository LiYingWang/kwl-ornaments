---
title: "Title Goes Here"
author:
  - Author One
  - Author Two
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::html_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---


<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r, setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/"
)

```

# Introduction

Here is a citation [@Marwick2017]

# Background

```{r read-in-the-data, eval = FALSE}
library(here)
kwl_upper <- readxl::read_excel(here("analysis", "data", "raw_data", "Kiwulan_Ornament_Upper.xlsx"))
```

# Methods

# Results

```{r tidy-data, eval = FALSE}
# summarise the ornaments by layers
library(tidyverse)
library(ggplot2)

# L5 and L6 represent pre-European contact period, 
# L4 was the time of European contact, and 
# L2 and L1 was the period of Chinese contact. 

ornaments_period <- 
kwl_upper %>% 
  filter(!is.na(`6-layers`)) %>% 
  mutate(period = case_when(
    `6-layers` %in% 1:2 ~ "Chinese Contact",
    `6-layers` == 4 ~ "European Contact",
    `6-layers` %in% 5:6 ~ "Before European Contact",
     TRUE ~ "other"
  )) %>% 
  filter(period != "other")
```


```{r plot-counts}
# need to reorder, try https://forcats.tidyverse.org/reference/index.html
# reorder factor for categories (by frequency) and period (manually)
# total number of ornaments for each categories 

ornaments_count_test <-
  ornaments_period %>% 
  filter(!is.na(`6-layers`),
         Categories != "Unknown Metal") %>% 
  mutate(Categories = fct_lump(Categories, 
                               n = 5)) %>% 
  group_by(Categories) %>%
  count() %>% 
  ungroup() %>% 
  mutate(Categories = fct_reorder(Categories, n))

ggplot(ornaments_count_test,
       aes(Categories, n)) +
  geom_col() +
  coord_flip() +
  labs(y = "Frequency",
       x = "Categories") +
  theme_minimal(base_size = 14)
```


```{r plot-counts-by-period}
# categories of ornaments by period
ornaments_count <-
  ornaments_period %>% 
  filter(!is.na(`6-layers`),
         Categories != "Unknown Metal") %>% 
  mutate(Categories = fct_lump(Categories, 
                               n = 5)) %>% 
  mutate(Categories = fct_infreq(Categories)) %>% 
  mutate(Categories = fct_rev(Categories)) %>% 
  group_by(period, Categories) %>%
  count() %>% 
  ungroup() 
  

ggplot(transform(ornaments_count,
                 period = factor(period, 
                                     levels = c("Before European Contact", 
                                                "European Contact", 
                                                "Chinese Contact")))) +
  geom_col(aes(Categories, n)) +
  facet_wrap(~ period) +
  coord_flip() +
  labs(y = "Frequency",
       x = "Categories") +
  theme_minimal(base_size = 14)
```

```{r get-data, eval = FALSE}
# plot for intact golden bead by period
ornaments_intact_gold <-
  ornaments_period %>% 
  filter(Condition == 'complete',
         Categories == 'Golden bead') %>% 
  mutate(Length = as.numeric(`Length(mm)`),
         Thick = as.numeric(`Thick(mm)`),
         Width = as.numeric(`Width(mm)`)) %>% 
  rowwise() %>% 
  mutate(Perforation_average = mean(c(`Perforation1(mm)`, `Perforation2(mm)`), 
                               na.rm = TRUE))
  
ggplot(transform(ornaments_intact_gold,
                 period = factor(period, 
                                     levels = c("Before European Contact", 
                                                "European Contact", 
                                                "Chinese Contact")))) +
  geom_point(aes(Length, Width, col = Perforation_average)) +
  facet_wrap(~ period) +
  labs(x = "Length (mm)",
       y = "Width (mm)",
       title = "Golden beads") +
  coord_fixed(ratio = 1) +
  theme_minimal() +
  theme(plot.title = element_text(hjust=0.5))

# plot for intact agate bead by period
ornaments_intact_agate <-
  ornaments_period %>% 
  filter(Condition == c('complete','near-complete'),
         Categories == 'Agate bead') %>% 
  mutate(Length = as.numeric(`Length(mm)`),
         Thick = as.numeric(`Thick(mm)`),
         Width = as.numeric(`Width(mm)`)) %>% 
  rowwise() %>% 
  mutate(Perforation_average = mean(c(`Perforation1(mm)`, `Perforation2(mm)`), 
                               na.rm = TRUE))
  
ggplot(ornaments_intact_agate, 
       aes(Length, Width, col = period))+
  geom_point() +
  labs(x = "Length (mm)",
       y = "Width (mm)",
       title = "Agate beads") +
  coord_fixed(ratio = 1) +
  theme_minimal() +
  theme(plot.title = element_text(hjust=0.5))
```

```{r get-data, eval = FALSE}
# plot for different shape of agate bead by period
agate_bead_shape <-
  ornaments_period %>% 
  filter(Categories == 'Agate bead') %>% 
  mutate(Type = ifelse(Type == 'prism/octagonal', 
                       str_remove(Type, '/octagonal'), Type)) %>% 
  mutate(Type = ifelse(Type == 'prism/pentagonal', 
                       str_remove(Type, '/pentagonal'), Type)) %>% 
  mutate(Type = ifelse(Type == 'prism/hexagonal', 
                       str_remove(Type, 'prism/'), Type)) %>% 
  mutate(Type = fct_infreq(Type)) %>% 
  mutate(Type = fct_rev(Type)) %>% 
  group_by(period, Type) %>% 
  count()

ggplot(transform(agate_bead_shape,
                 period = factor(period, 
                                     levels = c("Before European Contact", 
                                                "European Contact", 
                                                "Chinese Contact")))) +
  geom_col(aes(Type, n)) +
  facet_wrap(~ period) +
  coord_flip() +
  labs(y = "Frequency",
       x = "Shape of Agate bead") +
  theme_minimal(base_size = 14)
```

ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "dodge")

# Discussion

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
git2r::repository(here::here())
```
